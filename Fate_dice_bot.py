import random
from telegram import Update
from telegram.ext import Updater, CommandHandler, CallbackContext

# ==== –¢–æ–ª–∫–æ–≤–∞–Ω–∏—è ====
SUM_INTERPRETATION = {
    2: "‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ. –ù–µ –≤—Ä–µ–º—è, –Ω–µ —Ç—ã, –Ω–µ —Å—É–¥—å–±–∞.",
    3: "üïØÔ∏è –¢–µ–Ω—å —à–∞–Ω—Å–∞. –û—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏–π –ø—Ä–æ–±–ª–µ—Å–∫.",
    4: "‚öñÔ∏è –í—Å—ë –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤. –ù—É–∂–Ω—ã —É—Å–∏–ª–∏—è.",
    5: "üåÄ –ù–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å. –ü–µ—Ä–µ–º–µ–Ω—ã –≤ –¥–≤–∏–∂–µ–Ω–∏–∏.",
    6: "üå´Ô∏è –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –µ—Å—Ç—å, –Ω–æ —Å–∫—Ä—ã—Ç–∞. –¢—Ä–µ–±—É–µ—Ç—Å—è –∏–Ω—Ç—É–∏—Ü–∏—è.",
    7: "üí´ –ü–æ–ª—É—á–∏—Ç—Å—è, –Ω–æ –Ω–µ —Ç–∞–∫, –∫–∞–∫ —Ç—ã –¥—É–º–∞–µ—à—å.",
    8: "üîÆ –í—ã—Å–æ–∫–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —É—Å–ø–µ—Ö–∞. –î–µ–π—Å—Ç–≤—É–π!",
    9: "üåü –î–∞, –µ—Å–ª–∏ –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —É–º–Ω–æ –∏ –≤–æ–≤—Ä–µ–º—è.",
    10: "üèÜ –£—Å–ø–µ—Ö –ø–æ—á—Ç–∏ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω. –ü–æ–±–µ–¥–∞ –±–ª–∏–∑–∫–∞.",
    11: "üåà –ß—É–¥–æ –∏–ª–∏ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π –ø–æ–≤–æ—Ä–æ—Ç. –ë–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω—ã–π –∑–Ω–∞–∫.",
    12: "‚úÖ –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç. –°—É–¥—å–±–∞ –≥–æ–≤–æ—Ä–∏—Ç '–¥–∞'.",
}

DICE_COMBINATIONS = {
    (1, 1): "–¶–∏–∫–ª –∑–∞–≤–µ—Ä—à—ë–Ω. –ù–∞—á–Ω—ë—Ç—Å—è –Ω–æ–≤–æ–µ.",
    (1, 2): "–ü–µ—Ä–≤—ã–π —à–∞–≥. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –¥–≤–µ—Ä—å.",
    (1, 3): "–ú—ã—Å–ª–∏ –æ –≤–æ–∑–º–æ–∂–Ω–æ–º –±—É–¥—É—â–µ–º.",
    (1, 4): "–ù—É–∂–Ω–æ –≤—Ä–µ–º—è. –ü–æ–¥–æ–∂–¥–∏.",
    (1, 5): "–õ–æ–º–∫–∞ —Å—Ç–∞—Ä–æ–≥–æ. –ù–æ–≤–æ–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è.",
    (1, 6): "–ß—É–¥–æ –≤–æ–∑–º–æ–∂–Ω–æ. –£–¥–∞—á–∞ –Ω–∞ —Ç–≤–æ–µ–π —Å—Ç–æ—Ä–æ–Ω–µ.",
    (2, 2): "–¢—ã –≤–∏–¥–∏—à—å —Å–µ–±—è —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã. –ò—Å–ø—ã—Ç–∞–Ω–∏–µ –∑–µ—Ä–∫–∞–ª–æ–º.",
    (2, 3): "–î–∏–∞–ª–æ–≥ –≤–Ω—É—Ç—Ä–∏ —Ç–µ–±—è. –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç –∏–ª–∏ –≥–∞—Ä–º–æ–Ω–∏—è.",
    (2, 4): "–ë–∞–ª–∞–Ω—Å —Å–∏–ª. –ù—É–∂–Ω–æ –Ω–∞–π—Ç–∏ —Ä–∞–≤–Ω–æ–≤–µ—Å–∏–µ.",
    (2, 5): "–ü–µ—Ä–µ–º–µ–Ω—ã –Ω–µ–∏–∑–±–µ–∂–Ω—ã. –ü—Ä–∏–º–∏ –∏—Ö.",
    (2, 6): "–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–≤—ã—à–µ. –ö—Ç–æ-—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç —Ç–µ–±–µ.",
    (3, 3): "–°–æ–∑–¥–∞–Ω–∏–µ. –ß—Ç–æ —Ç—ã –∑–∞–¥—É–º–∞–ª ‚Äî –≤–æ–ø–ª–æ—Ç–∏—Ç—Å—è.",
    (3, 4): "–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ. –¢—ã —Å—Ç—Ä–æ–∏—à—å –Ω–æ–≤—ã–π —ç—Ç–∞–ø.",
    (3, 5): "–†–∞–∑—Ä—É—à–µ–Ω–∏–µ –¥–ª—è —Ä–æ—Å—Ç–∞. –°—Ç–∞—Ä–æ–µ —É—Ö–æ–¥–∏—Ç.",
    (3, 6): "–¢–≤–æ—Ä—á–µ—Å–∫–∞—è –ø–æ–±–µ–¥–∞. –ò—Å–∫—É—Å—Å—Ç–≤–æ –∏–ª–∏ –ø—Ä–æ–µ–∫—Ç –±—É–¥—É—Ç –∑–∞–º–µ—á–µ–Ω—ã.",
    (4, 4): "–ò—Å–ø—ã—Ç–∞–Ω–∏–µ —Ç–µ—Ä–ø–µ–Ω–∏–µ–º. –°–∏–ª–∞ –≤ —Å—Ç–æ–π–∫–æ—Å—Ç–∏.",
    (4, 5): "–ö–æ–Ω–µ—Ü –æ–¥–Ω–æ–≥–æ, –Ω–∞—á–∞–ª–æ –¥—Ä—É–≥–æ–≥–æ. –ü–µ—Ä–µ—Ö–æ–¥.",
    (4, 6): "–°—Ç–∞–±–∏–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞. –£—Å–ø–µ—Ö –±—É–¥–µ—Ç –¥–æ–ª–≥–∏–º.",
    (5, 5): "–ü–æ–ª–Ω–æ–µ —Ä–∞–∑—Ä—É—à–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ.",
    (5, 6): "–†–µ–∑–∫–∏–π —Å–∫–∞—á–æ–∫. –í–Ω–µ–∑–∞–ø–Ω—ã–π —É—Å–ø–µ—Ö.",
    (6, 6): "–í—ã—Å—à–∞—è —É–¥–∞—á–∞. –í—Å–µ –∑–≤—ë–∑–¥—ã —Å–æ—à–ª–∏—Å—å.",
}

# ==== –§—É–Ω–∫—Ü–∏–∏ ====
def throw_dice():
    """–ë—Ä–æ—Å–∞–µ—Ç –¥–≤–µ –∏–≥—Ä–∞–ª—å–Ω—ã–µ –∫–æ—Å—Ç–∏"""
    return random.randint(1, 6), random.randint(1, 6)

def interpret(a, b):
    """–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±—Ä–æ—Å–∫–∞ –∫–æ—Å—Ç–µ–π"""
    total = a + b
    is_pair = a == b
    
    result = {
        "dice": (a, b),
        "total": total,
        "is_pair": is_pair,
        "energy": "a > b" if a > b else ("a < b" if a < b else "a = b"),
        "sum_interpretation": SUM_INTERPRETATION.get(total, "üìä –†–µ–∑—É–ª—å—Ç–∞—Ç —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ—Å–º—ã—Å–ª–µ–Ω–∏—è."),
        "combination_interpretation": DICE_COMBINATIONS.get((a, b), "üéØ –£–Ω–∏–∫–∞–ª—å–Ω–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è. –ü—Ä–∏—Å–ª—É—à–∞–π—Å—è –∫ –∏–Ω—Ç—É–∏—Ü–∏–∏.")
    }
    return result

# ==== –ö–æ–º–∞–Ω–¥–∞ /ask ====
def ask(update: Update, context: CallbackContext):
    """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É /ask —Å –≤–æ–ø—Ä–æ—Å–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    if not context.args:
        update.message.reply_text(
            "‚ùå –ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –ø–æ—Å–ª–µ –∫–æ–º–∞–Ω–¥—ã /ask.\n\n"
            "üìù –ü—Ä–∏–º–µ—Ä:\n"
            "/ask –ñ–¥–∞—Ç—å –ª–∏ –º–Ω–µ –ø–µ—Ä–µ–º–µ–Ω –≤ –∂–∏–∑–Ω–∏?\n"
            "/ask –°—Ç–æ–∏—Ç –ª–∏ –Ω–∞—á–∏–Ω–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç?\n"
            "/ask –ß—Ç–æ –º–µ–Ω—è –∂–¥–µ—Ç –≤ –±–ª–∏–∂–∞–π—à–µ–º –±—É–¥—É—â–µ–º?"
        )
        return

    user_question = " ".join(context.args)
    a, b = throw_dice()
    interpretation = interpret(a, b)

    # –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
    message = f"üîÆ **–í–æ–ø—Ä–æ—Å:** {user_question}\n\n"
    message += f"üé≤ **–ö–æ—Å—Ç–∏:** ({a}, {b}) ‚Üí –°—É–º–º–∞: {interpretation['total']}\n\n"
    message += f"üìú **–û—Å–Ω–æ–≤–Ω–æ–µ —Ç–æ–ª–∫–æ–≤–∞–Ω–∏–µ:** {interpretation['sum_interpretation']}\n"

    # –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–ª–∫–æ–≤–∞–Ω–∏–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏, –µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å
    combo_text = interpretation['combination_interpretation']
    if combo_text and combo_text != "üéØ –£–Ω–∏–∫–∞–ª—å–Ω–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è. –ü—Ä–∏—Å–ª—É—à–∞–π—Å—è –∫ –∏–Ω—Ç—É–∏—Ü–∏–∏.":
        message += f"\nüß© **–ö–æ–º–±–∏–Ω–∞—Ü–∏—è ({a},{b}):** {combo_text}"

    # –û—Å–æ–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ø–∞—Ä
    if interpretation["is_pair"]:
        message += f"\n\nüîÑ **–≠—Ç–æ –ø–∞—Ä–∞ {a}!** –û—Å–æ–±–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å–∏–ª."

    # –≠–Ω–µ—Ä–≥–∏—è —Å–∏—Ç—É–∞—Ü–∏–∏
    energy_meaning = {
        "a > b": "üî∏ –¢—ã –≤–µ–¥—ë—à—å —Å–∏—Ç—É–∞—Ü–∏—é. –ú–æ–∂–µ—à—å –∞–∫—Ç–∏–≤–Ω–æ –≤–ª–∏—è—Ç—å –Ω–∞ —Å–æ–±—ã—Ç–∏—è.",
        "a < b": "üî∏ –°–∏—Ç—É–∞—Ü–∏—è –≤–µ–¥—ë—Ç —Ç–µ–±—è. –ü—Ä–∏—Å–ª—É—à–∞–π—Å—è –∫ –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤–∞–º.",
        "a = b": "üî∏ –ì–∞—Ä–º–æ–Ω–∏—è –º–µ–∂–¥—É —Ç–≤–æ–µ–π –≤–æ–ª–µ–π –∏ –≤–Ω–µ—à–Ω–∏–º –º–∏—Ä–æ–º."
    }
    message += f"\n\n‚ö° **–≠–Ω–µ—Ä–≥–∏—è:** {energy_meaning[interpretation['energy']]}"

    # –î–æ–±–∞–≤–ª—è–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å
    message += "\n\n" + "‚ïê" * 40 + "\n"
    message += "üí´ *–û—Ä–∞–∫—É–ª —Å–æ–≤–µ—Ç—É–µ—Ç:* –î–æ–≤–µ—Ä—è–π, –Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π. –≠—Ç–æ –≤—Å–µ–≥–æ –ª–∏—à—å –∏–≥—Ä–∞!"

    update.message.reply_text(message, parse_mode='Markdown')

# ==== –ö–æ–º–∞–Ω–¥–∞ /start ====
def start(update: Update, context: CallbackContext):
    """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É /start"""
    welcome_text = """
üåü *–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –û—Ä–∞–∫—É–ª –ö–æ—Å—Ç–µ–π!* üåü

–Ø ‚Äî –±–æ—Ç –¥–ª—è –º–∏—Å—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π —Å –ø–æ–º–æ—â—å—é –∏–≥—Ä–∞–ª—å–Ω—ã—Ö –∫–æ—Å—Ç–µ–π.

üìñ **–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
–ù–∞–ø–∏—à–∏—Ç–µ `/ask` –∏ –≤–∞—à –≤–æ–ø—Ä–æ—Å –ø–æ—Å–ª–µ –∫–æ–º–∞–Ω–¥—ã.

üéØ **–ü—Ä–∏–º–µ—Ä—ã:**
‚Ä¢ `/ask –ñ–¥–∞—Ç—å –ª–∏ –º–Ω–µ –ø–µ—Ä–µ–º–µ–Ω?`
‚Ä¢ `/ask –°—Ç–æ–∏—Ç –ª–∏ –¥–æ–≤–µ—Ä—è—Ç—å —ç—Ç–æ–º—É —á–µ–ª–æ–≤–µ–∫—É?`
‚Ä¢ `/ask –ß—Ç–æ –¥–µ–Ω—å –≥—Ä—è–¥—É—â–∏–π –º–Ω–µ –≥–æ—Ç–æ–≤–∏—Ç?`

üé≤ –ë—Ä–æ—à—É –∫–æ—Å—Ç–∏ –∏ —Ä–∞—Å—Å–∫–∞–∂—É, —á—Ç–æ –æ–Ω–∏ –≥–æ–≤–æ—Ä—è—Ç –æ –≤–∞—à–µ–π —Å–∏—Ç—É–∞—Ü–∏–∏!

‚ö° *–ü–æ–º–Ω–∏—Ç–µ:* —ç—Ç–æ –≤—Å–µ–≥–æ –ª–∏—à—å –∏–≥—Ä–∞ –¥–ª—è —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è –∏ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è.
    """
    update.message.reply_text(welcome_text, parse_mode='Markdown')

# ==== –ö–æ–º–∞–Ω–¥–∞ /help ====
def help_command(update: Update, context: CallbackContext):
    """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É /help"""
    help_text = """
üìã **–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**

/start - –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º
/ask [–≤–æ–ø—Ä–æ—Å] - –ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å –æ—Ä–∞–∫—É–ª—É
/help - –ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç—É —Å–ø—Ä–∞–≤–∫—É

üé≠ **–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
–Ø –±—Ä–æ—Å–∞—é –¥–≤–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –∫–æ—Å—Ç–∏ –∏ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ:
‚Ä¢ –°—É–º–º—ã –≤—ã–ø–∞–≤—à–∏—Ö —á–∏—Å–µ–ª (2-12)
‚Ä¢ –ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –∫–æ—Å—Ç–µ–π
‚Ä¢ –≠–Ω–µ—Ä–≥–∏–∏ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è —á–∏—Å–µ–ª

üí´ –ü—É—Å—Ç—å –∫–æ—Å—Ç–∏ –Ω–∞–ø—Ä–∞–≤—è—Ç –≤–∞—Å –∫ –º—É–¥—Ä–æ—Å—Ç–∏!
    """
    update.message.reply_text(help_text, parse_mode='Markdown')

# ==== –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ ====
def error_handler(update: Update, context: CallbackContext):
    """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏"""
    print(f"–û—à–∏–±–∫–∞: {context.error}")
    if update and update.message:
        update.message.reply_text("‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.")

# ==== –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ ====
def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞"""
    # –ó–ê–ú–ï–ù–ò–¢–ï 'YOUR_BOT_TOKEN_HERE' –ù–ê –†–ï–ê–õ–¨–ù–´–ô –¢–û–ö–ï–ù –ë–û–¢–ê
    updater = Updater("7963571696:AAFEkKbe_V4eVf9TPhnaW4yQOijX-hI6tYk", use_context=True)
    dp = updater.dispatcher

    # –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
    dp.add_handler(CommandHandler("start", start))
    dp.add_handler(CommandHandler("ask", ask))
    dp.add_handler(CommandHandler("help", help_command))
    
    # –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
    dp.add_error_handler(error_handler)

    print("üöÄ –ë–æ—Ç –û—Ä–∞–∫—É–ª –ö–æ—Å—Ç–µ–π –∑–∞–ø—É—â–µ–Ω...")
    print("üì± –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Ctrl+C –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏")
    
    try:
        updater.start_polling()
        updater.idle()
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞: {e}")
    finally:
        print("üî¥ –ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")

if __name__ == '__main__':
    main()
